---
title:  "Application Gateway の TCP プロトコルサポートを試してみる（プレビュー）"
date:   2024-05-22 14:34:25
author_profile: false
draft: true
categories: Network
---

## こんなことを書いています

* Application Gateway では AFD や TR で可能な「トラフィックの重みづけでの負荷分散」ができない
* 作りこみで「疑似」重みづけをやってみる

## Application Gateway 

②というのは、回答させて頂いたVM#2を停止するという案の実現方法についてでしょうか。それであれば、基本的にはVM#2をシャットダウンか負荷分散のルールで用いるポートを閉じる（サービスを落とす）ことによって、負荷分散装置からはVM#2には通信はルーティングされません。
VM#1に問題があり、VM#2を利用する場合はVM#2を立ち上げることで、#2に通信がルーティングされるようになるという流れになります。
AppGW側のルールでルーティングさせない方法もありますが、もう１つはNSGで普段はVM#2へのルートを遮断しておき、VM#1が落ちたときにNSGを外してVM#2へのルートをつなげることで、上記方法は取れるかと考えています。
この場合、自動化を考えたときには作りこみが必要です
・VM#1が落ちた時にVM#2に適用されているNSGを外す（アラート→Logic Appsなど）
・VM#1が正常に戻った場合に、VM#2に通信が流れないようにNSGを適用する（Logic Appsなど）
